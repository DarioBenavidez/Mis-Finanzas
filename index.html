<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Gold - Dario v6.1 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card-bank { background: white; border: 2px solid #f1f5f9; border-radius: 20px; padding: 15px; }
        .btn-yellow { background-color: #FFD700; color: #000; font-weight: bold; border-radius: 12px; transition: 0.3s; }
        .alert-box { border-left: 8px solid #ef4444; background: #fef2f2; }
        .event-card { background: #FFD700; padding: 20px; border-radius: 25px; box-shadow: 0 6px 0 #d4b500; }
        .fixed-debt-border { border-left: 12px solid #64748b; }
        .installment-debt-border { border-left: 12px solid #ef4444; }
        .saving-card { border-left: 12px solid #22c55e; background: #f0fdf4; }
        .editable-amount { font-weight: 900; background: transparent; text-align: right; width: 100%; border-bottom: 2px solid transparent; }
        .editable-amount:focus { outline: none; border-bottom: 2px solid #000; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <div id="invoice-modal" class="modal" onclick="this.classList.remove('active')">
        <img id="modal-img" src="" class="max-w-full max-h-full rounded-lg">
    </div>

    <nav class="bg-white border-b-2 border-yellow-400 p-4 sticky top-0 z-50 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="font-black text-2xl italic uppercase">FINANZAS <span class="text-yellow-500">DARIO</span></h1>
            <div id="dolar-info" class="hidden md:block text-[10px] font-black text-slate-400 uppercase italic">Conectando...</div>
            <div class="flex gap-3 text-[10px] font-black uppercase">
                <button onclick="showTab('dashboard')">Inicio</button>
                <button onclick="showTab('servicios')">Servicios</button>
                <button onclick="showTab('creditos')">Deudas</button>
                <button onclick="showTab('ahorros')">Ahorros</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-6">
        
        <section id="dashboard" class="tab-content active">
            <div id="alertas-vencimiento" class="mb-6 space-y-2"></div>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8" id="bank-cards"></div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-3xl border border-slate-100"><canvas id="projectionChart" height="150"></canvas></div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100"><canvas id="categoryChart"></canvas></div>
                <div class="bg-white p-6 rounded-3xl border-2 border-yellow-400 text-center">
                    <div class="p-5 rounded-2xl bg-slate-50 mb-4 shadow-inner">
                        <p class="text-[10px] font-black text-slate-400 uppercase italic mb-1">Saldo Real Disponible</p>
                        <p id="total-cash" class="text-4xl font-black tracking-tighter">$ 0</p>
                    </div>
                    <div class="text-left space-y-1 mb-6 text-[10px] font-black uppercase px-2">
                        <div class="flex justify-between text-green-600"><span>Bancos (+):</span> <span id="sum-banks">$ 0</span></div>
                        <div class="flex justify-between text-red-500"><span>Gastos/Deudas (-):</span> <span id="sum-debts">$ 0</span></div>
                        <div class="flex justify-between text-blue-600"><span>Ahorros (-):</span> <span id="sum-savings">$ 0</span></div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="copiarDatos()" class="flex-1 btn-yellow py-3 text-[10px] uppercase">ðŸ“¤ Copiar</button>
                        <button onclick="importarDatos()" class="flex-1 bg-black text-white py-3 rounded-xl text-[10px] font-bold uppercase">ðŸ“¥ Pegar</button>
                    </div>
                </div>
            </div>

            <div class="mt-12">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-black text-xl italic uppercase">Eventos Especiales</h3>
                    <button onclick="addEvent()" class="btn-yellow px-6 py-2 text-[10px] uppercase shadow-sm">+ Nuevo Evento</button>
                </div>
                <div id="events-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <section id="servicios" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-3xl border space-y-4" id="services-checklist"></div>
                <div class="md:col-span-2 bg-white p-6 rounded-3xl border">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-black italic uppercase">GestiÃ³n de Facturas</h2>
                        <button onclick="document.getElementById('file-input').click()" class="btn-yellow px-4 py-2 text-[10px] uppercase italic">+ CARGAR COMPROBANTE</button>
                        <input type="file" id="file-input" class="hidden" accept="image/*" onchange="processFile(this)">
                    </div>
                    <div id="history-list" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <section id="creditos" class="tab-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black italic uppercase italic">Compromisos</h2>
                <div class="flex gap-2">
                    <button onclick="addItem('credits', true)" class="bg-slate-800 text-white px-4 py-3 text-[10px] font-black rounded-xl uppercase">+ Fijo</button>
                    <button onclick="addItem('credits', false)" class="btn-yellow px-4 py-3 text-[10px] uppercase shadow-md">+ Cuotas</button>
                </div>
            </div>
            <div id="credit-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>

        <section id="ahorros" class="tab-content">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black italic uppercase text-green-700 italic">Huchas de Ahorro</h2>
                <button onclick="addItem('savings')" class="bg-green-600 text-white px-6 py-3 text-[10px] font-black rounded-xl uppercase">+ Nueva Meta</button>
            </div>
            <div id="savings-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('finanzas_gold_v1')) || {
            user: "Dario",
            banks: [{name:"M. PAGO", bal:0}, {name:"ASTROPAY", bal:0}, {name:"BBVA", bal:0}, {name:"SANTANDER", bal:0}, {name:"YPF", bal:0}],
            credits: [], events: [], savings: [], services: [],
            serviceStatus: {Luz: 0, Agua: 0, Gas: 0, Internet: 0}
        };
        if(!db.services) db.services = [];

        let cotizacionDolar = 1250;

        async function fetchDolar() {
            try {
                const res = await fetch('https://argentinadatos.com/api/v1/cotizaciones/dolares');
                const data = await res.json();
                const blue = data.find(d => d.casa === "blue")?.venta;
                if(blue) cotizacionDolar = blue;
            } catch (e) { console.error("API error"); }
            finally {
                document.getElementById('dolar-info').innerText = `DÃ³lar Blue: $${cotizacionDolar}`;
                actualizarTotales();
            }
        }

        function init() { fetchDolar(); renderBanks(); renderAll(); }

        function renderBanks() {
            document.getElementById('bank-cards').innerHTML = db.banks.map((b, i) => `
                <div class="card-bank border border-slate-100 shadow-sm">
                    <p class="text-[9px] font-black text-slate-400 uppercase italic mb-2">${b.name}</p>
                    <div class="flex items-center text-2xl font-black text-slate-800">
                        <span class="text-slate-300 mr-1">$</span>
                        <input type="number" value="${b.bal}" oninput="updateBank(${i}, this.value)" class="w-full bg-transparent focus:outline-none">
                    </div>
                </div>`).join('');
        }

        function renderAll() {
            // EVENTOS

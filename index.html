<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Gold - Control Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .bg-primary { background-color: #FFD700; }
        .btn-yellow { background-color: #FFD700; color: #000; font-weight: bold; border-radius: 12px; transition: all 0.3s; }
        .btn-yellow:hover { background-color: #FACC15; transform: scale(1.02); }
        .btn-black { background-color: #000; color: #fff; font-weight: bold; border-radius: 12px; }
    </style>
</head>
<body class="bg-white text-slate-900">

    <nav class="bg-white border-b-2 border-yellow-400 p-4 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="font-black text-2xl tracking-tighter" id="user-header">FINANZAS <span class="text-yellow-500">GOLD</span></h1>
            <div class="flex gap-3 text-xs font-bold uppercase">
                <button onclick="showTab('dashboard')" class="hover:text-yellow-600">Inicio</button>
                <button onclick="showTab('servicios')" class="hover:text-yellow-600">Servicios</button>
                <button onclick="showTab('creditos')" class="hover:text-yellow-600">Deudas</button>
                <button onclick="exportToExcel()" class="bg-black text-white px-3 py-1 rounded-lg">Excel</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4">
        
        <section id="dashboard" class="tab-content active">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8" id="bank-cards"></div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-slate-50 p-6 rounded-3xl border border-slate-100">
                    <h3 class="font-bold mb-4 text-slate-500 uppercase text-xs tracking-widest">Proyecci√≥n de disponibilidad</h3>
                    <canvas id="projectionChart" height="130"></canvas>
                </div>

                <div class="bg-white p-6 rounded-3xl border-2 border-yellow-400 shadow-xl">
                    <h3 class="font-bold text-lg mb-4">Ajustes de Cuenta</h3>
                    <input type="text" id="username-input" oninput="updateUser(this.value)" placeholder="Tu nombre" class="w-full border-b-2 border-slate-100 p-2 mb-6 focus:outline-none focus:border-yellow-400 font-bold">
                    
                    <div class="p-4 rounded-2xl bg-yellow-50 mb-6 text-center">
                        <p class="text-[10px] font-black uppercase text-yellow-700">Total Consolidado</p>
                        <p id="total-cash" class="text-3xl font-black">$0</p>
                    </div>

                    <div class="space-y-3">
                        <p class="text-[10px] font-bold text-slate-400 uppercase text-center">Sincronizaci√≥n manual</p>
                        <button onclick="copiarDatos()" class="w-full btn-yellow py-3 text-sm">üì§ COPIAR DATOS PARA CELULAR</button>
                        <button onclick="importarDatos()" class="w-full btn-black py-3 text-sm">üì• PEGAR DATOS DE OTRO DISP.</button>
                    </div>
                </div>
            </div>

            <div class="mt-10">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg italic">Eventos Especiales</h3>
                    <button onclick="addEvent()" class="text-xs font-bold bg-slate-100 px-3 py-1 rounded-full">+ CREAR</button>
                </div>
                <div id="events-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
            </div>
        </section>

        <section id="servicios" class="tab-content">
            <div class="bg-white p-6 rounded-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black">HISTORIAL SERVICIOS</h2>
                    <button onclick="addServicePayment()" class="btn-yellow px-6 py-2 shadow-lg">+ CARGAR FACTURA</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="text-slate-400 text-xs uppercase text-left border-b">
                            <tr><th class="p-4">Servicio</th><th class="p-4">Fecha</th><th class="p-4 text-right">Monto</th><th class="p-4"></th></tr>
                        </thead>
                        <tbody id="services-table-body" class="text-sm"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="creditos" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h2 class="text-xl font-black mb-4 uppercase">Cr√©ditos y Tarjetas</h2>
                    <div id="credit-list" class="space-y-4"></div>
                    <button onclick="addCredit()" class="w-full mt-6 py-3 border-2 border-yellow-400 rounded-2xl font-bold hover:bg-yellow-50 transition">+ AGREGAR CR√âDITO</button>
                </div>
                <div>
                    <h2 class="text-xl font-black mb-4 uppercase">Fijos Mensuales</h2>
                    <div id="fixed-items-list" class="space-y-2"></div>
                    <button onclick="addFixedItem()" class="w-full mt-4 bg-slate-900 text-white py-3 rounded-2xl font-bold text-sm">+ AGREGAR √çTEM</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // MOTOR DE DATOS
        let db = JSON.parse(localStorage.getItem('finanzas_gold_v1')) || {
            user: "Usuario",
            banks: [
                {name: "M. PAGO", bal: 0}, {name: "ASTROPAY", bal: 0}, 
                {name: "BBVA", bal: 0}, {name: "SANTANDER", bal: 0}, {name: "YPF", bal: 0}
            ],
            fixedItems: [], services: [], credits: [], events: [] 
        };

        function save() {
            localStorage.setItem('finanzas_gold_v1', JSON.stringify(db));
            render();
        }

        // FUNCIONES DE SINCRONIZACI√ìN
        function copiarDatos() {
            const dataStr = JSON.stringify(db);
            navigator.clipboard.writeText(dataStr).then(() => {
                alert("‚úÖ ¬°√âxito! Tus datos se han copiado al portapapeles. Ahora ve a tu otro dispositivo (celular/PC), abre tu app y presiona 'PEGAR DATOS'.");
            });
        }

        function importarDatos() {
            const dataStr = prompt("Pega aqu√≠ el c√≥digo de datos que copiaste de tu otro dispositivo:");
            if(dataStr) {
                try {
                    const parsed = JSON.parse(dataStr);
                    if(parsed.banks) {
                        db = parsed;
                        save();
                        alert("‚úÖ Datos importados correctamente.");
                        location.reload();
                    }
                } catch(e) {
                    alert("‚ùå El c√≥digo pegado no es v√°lido. Aseg√∫rate de copiarlo bien.");
                }
            }
        }

        // RENDERIZADO MEJORADO
        function showTab(id) { 
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function updateUser(v) { db.user = v; save(); }
        
        // Guardado instant√°neo para bancos
        function updateBank(i, v) { 
            db.banks[i].bal = parseFloat(v) || 0; 
            localStorage.setItem('finanzas_gold_v1', JSON.stringify(db));
            const total = db.banks.reduce((acc, b) => acc + b.bal, 0);
            document.getElementById('total-cash').innerText = `$ ${total.toLocaleString()}`;
            updateChart(total);
        }

        function addServicePayment() {
            const name = prompt("Servicio:");
            const amount = parseFloat(prompt("Monto:"));
            const date = prompt("Fecha (MM/AAAA):", (new Date().getMonth()+1)+"/"+new Date().getFullYear());
            if(name && amount) { db.services.push({name, amount, date}); save(); }
        }

        function addCredit() {
            const name = prompt("Entidad:");
            const montoCuota = parseFloat(prompt("Valor cuota:"));
            const cuotasFaltantes = parseInt(prompt("Cuotas faltantes:"));
            if(name && montoCuota) { db.credits.push({name, montoCuota, cuotasFaltantes}); save(); }
        }

        function addFixedItem() {
            const name = prompt("Concepto:");
            const amount = parseFloat(prompt("Monto:"));
            const type = confirm("¬øEs INGRESO? (OK=S√ç / Cancelar=GASTO)") ? 'in' : 'out';
            if(name && amount) { db.fixedItems.push({name, amount, type}); save(); }
        }

        function addEvent() {
            const name = prompt("Nombre:");
            const budget = parseFloat(prompt("Presupuesto:"));
            if(name && budget) { db.events.push({name, budget}); save(); }
        }

        function render() {
            document.getElementById('user-header').innerHTML = `FINANZAS <span class="text-yellow-500">${db.user.toUpperCase()}</span>`;
            document.getElementById('user-display').innerText = db.user;
            document.getElementById('username-input').value = db.user;
            
            const bankContainer = document.getElementById('bank-cards');
            bankContainer.innerHTML = '';
            let totalCash = 0;
            db.banks.forEach((b, i) => {
                totalCash += b.bal;
                bankContainer.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl border-2 border-slate-100 shadow-sm">
                        <p class="text-[9px] font-black text-slate-400 uppercase mb-1">${b.name}</p>
                        <input type="number" oninput="updateBank(${i}, this.value)" value="${b.bal}" class="w-full font-black text-lg focus:outline-none bg-transparent">
                    </div>
                `;
            });
            document.getElementById('total-cash').innerText = `$ ${totalCash.toLocaleString()}`;

            document.getElementById('services-table-body').innerHTML = db.services.slice().reverse().map((s, i) => `
                <tr class="border-b border-slate-50">
                    <td class="p-4 font-bold">${s.name}</td>
                    <td class="p-4 text-slate-400">${s.date}</td>
                    <td class="p-4 text-right font-black">$${s.amount.toLocaleString()}</td>
                    <td class="p-4 text-center"><button onclick="deleteService(${db.services.length-1-i})" class="text-slate-300 hover:text-red-500 font-bold">‚úï</button></td>
                </tr>
            `).join('');

            document.getElementById('credit-list').innerHTML = db.credits.map(c => `
                <div class="p-4 rounded-2xl bg-slate-50 flex justify-between items-center border-l-4 border-red-500">
                    <div><p class="font-black text-xs uppercase">${c.name}</p><p class="text-[10px] text-slate-400">${c.cuotasFaltantes} cuotas restantes</p></div>
                    <p class="font-black text-red-600">$${c.montoCuota.toLocaleString()}</p>
                </div>
            `).join('');

            document.getElementById('fixed-items-list').innerHTML = db.fixedItems.map(f => `
                <div class="flex justify-between p-3 border-b border-slate-50 text-sm">
                    <span class="font-bold text-slate-500">${f.name}</span>
                    <span class="font-black ${f.type==='in'?'text-green-600':'text-red-600'}">${f.type==='in'?'+':'-'}$${f.amount.toLocaleString()}</span>
                </div>
            `).join('');

            document.getElementById('events-grid').innerHTML = db.events.map(ev => `
                <div class="bg-yellow-400 p-5 rounded-3xl shadow-md">
                    <h4 class="font-black text-black uppercase text-sm">${ev.name}</h4>
                    <p class="text-xs font-bold text-yellow-900 mt-1">L√çMITE: $${ev.budget.toLocaleString()}</p>
                </div>
            `).join('');

            updateChart(totalCash);
        }

        function deleteService(i) { db.services.splice(i, 1); save(); }

        function updateChart(cash) {
            const ctx = document.getElementById('projectionChart').getContext('2d');
            const monthlyBalance = db.fixedItems.reduce((acc, c) => c.type === 'in' ? acc + c.amount : acc - c.amount, 0) 
                                   - db.credits.reduce((acc, c) => acc + c.montoCuota, 0);
            let data = [];
            for(let i=1; i<=6; i++) { data.push(cash + (monthlyBalance * i)); }

            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mes 1', 'Mes 2', 'Mes 3', 'Mes 4', 'Mes 5', 'Mes 6'],
                    datasets: [{
                        data: data,
                        borderColor: '#FFD700',
                        borderWidth: 4,
                        backgroundColor: 'rgba(255, 215, 0, 0.05)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        }

        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(db.banks), "Bancos");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(db.services), "Servicios");
            XLSX.writeFile(wb, "Finanzas_Gold.xlsx");
        }

        render();
    </script>
</body>
</html>
    </script>
</body>
</html>

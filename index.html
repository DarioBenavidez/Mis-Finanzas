<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Darío - Master Build GOLD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card-gold { background: white; border-radius: 25px; padding: 25px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; }
        .btn-yellow { background: #FFD700; color: black; font-weight: 900; border-radius: 15px; transition: 0.3s; cursor: pointer; }
        .btn-yellow:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
        .cuota-tag { color: #ef4444; font-size: 11px; font-weight: 800; margin-top: 4px; display: block; cursor: pointer; }
    </style>
</head>
<body class="bg-[#f8fafc] text-[#1e293b] font-sans">

    <div id="file-modal" class="modal" onclick="this.classList.remove('active')">
        <div class="max-w-4xl w-full p-4 flex flex-col items-center">
            <img id="modal-img" src="" class="max-w-full max-h-[80vh] rounded-lg hidden border-4 border-white">
            <iframe id="modal-pdf" src="" class="w-full h-[80vh] rounded-lg hidden bg-white"></iframe>
            <button class="mt-6 bg-white text-black px-10 py-3 rounded-full font-black uppercase shadow-2xl">Cerrar</button>
        </div>
    </div>

    <nav class="bg-white border-b-2 border-yellow-400 p-6 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="font-black text-2xl italic uppercase tracking-tighter">FINANZAS <span class="text-yellow-500">DARIO</span></h1>
            <div id="dolar-info" class="text-[11px] font-black text-slate-400 italic uppercase">Dólar: Cargando...</div>
            <div class="flex gap-6 text-[11px] font-black uppercase tracking-widest">
                <button onclick="showTab('inicio')">Inicio</button>
                <button onclick="showTab('servicios')">Servicios</button>
                <button onclick="showTab('deudas')">Deudas</button>
                <button onclick="showTab('ahorros')" class="text-green-600">Ahorros</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6">
        
        <section id="inicio" class="tab-content active">
            <div id="bancos-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-10"></div>
            
            <div class="max-w-2xl mx-auto card-gold border-2 border-yellow-400 text-center">
                <p class="text-[11px] font-black text-slate-400 uppercase italic mb-2">Saldo Real (Bancos + Ahorros - Deudas)</p>
                <p id="saldo-total" class="text-7xl font-black tracking-tighter mb-8">$ 0</p>
                <div class="flex gap-3 justify-center">
                    <button onclick="exportar()" class="btn-yellow px-10 py-4 text-xs uppercase">Copiar Backup</button>
                    <button onclick="importar()" class="bg-black text-white px-10 py-4 rounded-2xl text-xs font-black uppercase">Restaurar Datos</button>
                </div>
            </div>
        </section>

        <section id="servicios" class="tab-content">
            <h2 class="text-3xl font-black italic uppercase mb-8">Servicios y Facturas</h2>
            <div id="servicios-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10"></div>
            
            <div class="card-gold">
                <h3 class="font-black uppercase text-sm mb-4 border-b pb-2 flex items-center gap-2">
                    <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-width="2"/></svg>
                    Historial de Comprobantes (Ojo para ver)
                </h3>
                <div id="historial-grid" class="space-y-3"></div>
            </div>
        </section>

        <section id="deudas" class="tab-content">
            <div class="flex justify-between items-end mb-8">
                <h2 class="text-3xl font-black italic uppercase">Deudas y Compromisos</h2>
                <div class="flex gap-2">
                    <button onclick="nuevaDeuda(false)" class="bg-slate-800 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase">+ Gasto Fijo</button>
                    <button onclick="nuevaDeuda(true)" class="btn-yellow px-6 py-3 text-[10px] uppercase shadow-md">+ Deuda en Cuotas</button>
                </div>
            </div>
            <div id="deudas-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>

        <section id="ahorros" class="tab-content">
            <div class="flex justify-between items-end mb-8">
                <h2 class="text-3xl font-black italic uppercase text-green-700">Sistema de Ahorros</h2>
                <button onclick="nuevoAhorro()" class="bg-green-600 text-white px-8 py-3 rounded-xl text-[10px] font-black uppercase">+ Nueva Meta</button>
            </div>
            <div id="ahorros-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('dario_master_final')) || {
            bancos: [{n:"M. PAGO", v:0}, {n:"ASTROPAY", v:0}, {n:"BBVA", v:0}, {n:"SANTANDER", v:0}, {n:"YPF", v:0}],
            servicios_monto: {LUZ:0, AGUA:0, GAS:0, INTERNET:0},
            deudas: [],
            ahorros: [],
            comprobantes: []
        };

        let usdPrice = 1250;

        async function fetchDolar() {
            try {
                const r = await fetch('https://argentinadatos.com/api/v1/cotizaciones/dolares');
                const d = await r.json();
                usdPrice = d.find(x => x.casa === "blue")?.venta || 1250;
                document.getElementById('dolar-info').innerText = `Dólar Blue: $${usdPrice} (Auto)`;
            } catch(e) { console.error("Error Dolar"); }
            render();
        }

        function render() {
            // BANCOS
            document.getElementById('bancos-grid').innerHTML = db.bancos.map((b, i) => `
                <div class="card-gold">
                    <p class="text-[10px] font-black text-slate-400 mb-2 uppercase italic">${b.n}</p>
                    <div class="flex items-center text-2xl font-black">$ <input type="number" value="${b.v}" oninput="uBnk(${i},this.value)" class="w-full bg-transparent outline-none text-right font-black focus:text-yellow-500"></div>
                </div>`).join('');

            // SERVICIOS
            document.getElementById('servicios-grid').innerHTML = Object.keys(db.servicios_monto).map(s => `
                <div class="card-gold flex justify-between items-center">
                    <p class="font-black text-xs italic uppercase text-slate-400">${s}</p>
                    <div class="flex items-center gap-4">
                        <div class="text-3xl font-black text-yellow-500">$ <input type="number" value="${db.servicios_monto[s]}" oninput="uSrv('${s}',this.value)" class="w-32 bg-transparent outline-none text-right font-black"></div>
                        <button onclick="upFile('${s}')" class="bg-slate-100 p-3 rounded-full hover:bg-yellow-400 transition shadow-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12" stroke-width="2"/></svg>
                        </button>
                    </div>
                </div>`).join('');

            // HISTORIAL CON EL OJO
            document.getElementById('historial-grid').innerHTML = db.comprobantes.slice().reverse().map((c, i) => `
                <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-slate-100 shadow-sm">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-black text-yellow-400 rounded-full flex items-center justify-center font-black text-xs">${c.n[0]}</div>
                        <div><p class="font-black text-sm uppercase">${c.n}</p><p class="text-[9px] font-bold text-slate-400">${c.d}</p></div>
                    </div>
                    <div class="flex items-center gap-6">
                        <span class="font-black text-lg">$ ${c.a.toLocaleString()}</span>
                        <button onclick="verFile('${c.f}')" class="text-blue-500 hover:scale-110 transition">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7" stroke-width="2"/></svg>
                        </button>
                        <button onclick="delComp(${db.comprobantes.length - 1 - i})" class="text-slate-300">✕</button>
                    </div>
                </div>`).join('');

            // DEUDAS
            document.getElementById('deudas-grid').innerHTML = db.deudas.map((d, i) => `
                <div class="card-gold flex justify-between items-center border-l-8 ${d.q ? 'border-red-500' : 'border-slate-800'}">
                    <div class="flex-1">
                        <p class="text-[10px] font-black text-slate-400 uppercase italic">${d.q ? 'Cuotas' : 'Fijo'}</p>
                        <p class="font-black text-xl uppercase tracking-tighter text-slate-700">${d.n}</p>
                        ${d.q ? `<span class="cuota-tag" onclick="uQ(${i})">Restan ${d.q} cuotas</span>` : ''}
                        <input type="date" value="${d.vto || ''}" onchange="uDd(${i},'vto',this.value)" class="text-[10px] font-bold bg-slate-50 p-1 rounded mt-2 outline-none">
                    </div>
                    <div class="text-right">
                        <div class="text-4xl font-black">${d.usd ? 'u$s' : '$'} <input type="number" value="${d.v}" oninput="uDd(${i},'v',this.value)" class="w-28 bg-transparent outline-none text-right font-black"></div>
                        <div class="flex gap-4 justify-end mt-2">
                            <button onclick="tUsd(${i})" class="text-[9px] font-black text-blue-500 uppercase italic">USD/ARS</button>
                            <button onclick="delDd(${i})" class="text-[9px] font-black text-slate-300 uppercase">Borrar</button>
                        </div>
                    </div>
                </div>`).join('');

            // AHORROS
            document.getElementById('ahorros-grid').innerHTML = db.ahorros.map((a, i) => `
                <div class="card-gold border-l-8 border-green-500 flex justify-between items-center shadow-sm">
                    <p class="font-black text-xl uppercase italic text-slate-700">${a.n}</p>
                    <div class="text-right">
                        <div class="text-4xl font-black text-green-600">$ <input type="number" value="${a.v}" oninput="uAh(${i},this.value)" class="w-32 bg-transparent outline-none text-right font-black"></div>
                        <button onclick="delAh(${i})" class="text-[10px] font-black text-slate-200 uppercase mt-1">Eliminar</button>
                    </div>
                </div>`).join('');

            calc();
        }

        function calc() {
            const bnk = db.bancos.reduce((a, b) => a + (parseFloat(b.v) || 0), 0);
            const ah = db.ahorros.reduce((a, b) => a + (parseFloat(b.v) || 0), 0);
            const srv = Object.values(db.servicios_monto).reduce((a, b) => a + (parseFloat(b) || 0), 0);
            const dd = db.deudas.reduce((a, b) => a + (b.usd ? (b.v * usdPrice) : (parseFloat(b.v) || 0)), 0);
            
            const total = (bnk + ah) - (srv + dd);
            const el = document.getElementById('saldo-total');
            el.innerText = `$ ${total.toLocaleString('es-AR')}`;
            el.className = total >= 0 ? 'text-7xl font-black tracking-tighter mb-8 text-slate-800' : 'text-7xl font-black tracking-tighter mb-8 text-red-600';
        }

        // FUNCIONES DE CARGA Y GESTIÓN
        function uBnk(i,v) { db.bancos[i].v = v; save(); calc(); }
        function uSrv(s,v) { db.servicios_monto[s] = v; save(); calc(); }
        function uDd(i,f,v) { db.deudas[i][f] = (f==='v') ? v : v; save(); calc(); }
        function uAh(i,v) { db.ahorros[i].v = v; save(); calc(); }
        function uQ(i) { const q = prompt("Cuotas faltantes:"); if(q) { db.deudas[i].q = q; save(); render(); } }
        function tUsd(i) { db.deudas[i].usd = !db.deudas[i].usd; save(); render(); }

        function upFile(name) {
            const input = document.createElement('input');
            input.type = 'file'; input.accept = 'image/*,application/pdf';
            input.onchange = e => {
                const f = e.target.files[0];
                const a = prompt("Monto pagado:"); if(!a) return;
                const r = new FileReader();
                r.onload = ev => {
                    db.comprobantes.push({n:name, a:parseFloat(a), d:new Date().toLocaleDateString(), f:ev.target.result});
                    save(); render();
                };
                r.readAsDataURL(f);
            };
            input.click();
        }

        function verFile(f) {
            const m = document.getElementById('file-modal');
            const img = document.getElementById('modal-img');
            const pdf = document.getElementById('modal-pdf');
            img.classList.add('hidden'); pdf.classList.add('hidden');
            if(f.includes('pdf')) { pdf.src = f; pdf.classList.remove('hidden'); }
            else { img.src = f; img.classList.remove('hidden'); }
            m.classList.add('active');
        }

        function nuevaDeuda(isQ) {
            const n = prompt("Nombre:"); if(!n) return;
            db.deudas.push({n, v:0, q: isQ ? 1 : null, usd:false, vto:''}); save(); render();
        }

        function nuevoAhorro() {
            const n = prompt("Meta:"); if(n) { db.ahorros.push({n, v:0}); save(); render(); }
        }

        function delComp(i) { if(confirm("¿Borrar?")) { db.comprobantes.splice(i,1); save(); render(); } }
        function delDd(i) { if(confirm("¿Borrar?")) { db.deudas.splice(i,1); save(); render(); } }
        function delAh(i) { if(confirm("¿Borrar?")) { db.ahorros.splice(i,1); save(); render(); } }
        
        function save() { localStorage.setItem('dario_master_final', JSON.stringify(db)); }
        function showTab(id) { document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function exportar() { navigator.clipboard.writeText(JSON.stringify(db)); alert("Backup copiado! ✅"); }
        function importar() { const d = prompt("Pegar backup:"); if(d) { db = JSON.parse(d); save(); location.reload(); } }

        window.onload = fetchDolar;
    </script>
</body>
</html>
